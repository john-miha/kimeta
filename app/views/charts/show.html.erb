<p>id: <%= @chart.id %> </p>

<h1>比較表タイトル：<%= @chart.title %></h1>
<h2>説明:<%= @chart.description %></h2>



<%# アイテムを重複して持たせる構造にしてしまった以上、重複を削除するしかない%>
<%# distinctメソッドで重複を削除したテーブルを作ってeach文を回せばOK。evaluation.nameは互いに独立しているから無理か。%>
<%# 観点からユニークな要素を抜きだして、要素名でfind_byして並べる%>
<%# アイテムからユニークな要素を抜き出して、要素名でfind_byして並べる%>

<% tmp_name = [] %>
<% tmp_viewpoint = [] %>

<% @chart.evaluations.each do |evaluation| %>
    <%# もしtmp_nameに evaluation.items.first.name が含まれていなければ保存%>
    <% if !tmp_name.include?(evaluation.items.first.name) then%>
        <% tmp_name.push(evaluation.items.first.name) %>
    <%# 含まれて入ればスキップ%>
    <% end %>
    <%# もしtmp_nameに evaluation.viewpoints.first.name が含まれていなければ保存%>
    <% if !tmp_viewpoint.include?(evaluation.viewpoints.first.name) then%>
        <% tmp_viewpoint.push(evaluation.viewpoints.first.name) %>
    <%# 含まれて入ればスキップ%>
    <% end %>

<% end %>
<%# ユニークなアイテム tmp_name %>
<%# ユニークな観点 tmp_viewpoint %>

<%# tmpclass = @chart.evaluations.find_by(comment: "c1") %>
<%#= tmpclass.score %>
<%#= tmpclass.comment %>

<%# 配列の非空判定 %>
<% if !@chart.evaluations.empty? %>

<table class="table">
<thead>
  <tr>
    <th>観点</th>
    <th><%= tmp_name[0]%></th>
    <th><%= tmp_name[1]%></th>
    <th><%= tmp_name[2]%></th>
  </tr>
</thead>
<tbody>
<tr>
  <td><%= tmp_viewpoint[0]%></td>
  <td>
    score:<%= @chart.evaluations.first.score %><br>
    comment:<%= @chart.evaluations.first.comment %>
  </td>
  <td>
    score:<%= @chart.evaluations[1].score %><br>
    comment:<%= @chart.evaluations[1].comment %>
  </td>
  <td>
    score:<%= @chart.evaluations[2].score %><br>
    comment:<%= @chart.evaluations[2].comment %>
  </td>
</tr>
<tr>
  <td><%= tmp_viewpoint[1]%></td>
  <td>
    score:<%= @chart.evaluations[3].score %><br>
    comment:<%= @chart.evaluations[3].comment %>
  </td>
  <td>
    score:<%= @chart.evaluations[4].score %><br>
    comment:<%= @chart.evaluations[4].comment %>
  </td>
  <td>
    score:<%= @chart.evaluations[5].score %><br>
    comment:<%= @chart.evaluations[5].comment %>
  </td>
</tr>
<tr>
  <td><%= tmp_viewpoint[2]%></td>
  <td>
    score:<%= @chart.evaluations[6].score %><br>
    comment:<%= @chart.evaluations[6].comment %>
  </td>
  <td>
    score:<%= @chart.evaluations[7].score %><br>
    comment:<%= @chart.evaluations[7].comment %>
  </td>
  <td>
    score:<%= @chart.evaluations[8].score %><br>
    comment:<%= @chart.evaluations[8].comment %>
  </td>
</tr>

<tbody>
</table>

<% else %>
    <p>評価項目がありません</p>
<% end %>

<%== pagy_bootstrap_nav(@pagy) %>

<%= link_to '一覧に戻る', charts_path %>
<%= link_to 'このメッセージを編集する', edit_chart_path(@chart) %>
<%= link_to 'このメッセージを削除する', @charts, method: :delete, data: { confirm: '本当に削除してよろしいですか？' } %>

<h1>id: <%= @chart.id %> のメッセージ詳細ページ</h1>

<p>Title: <%= @chart.title %></p>
<p>Description: <%= @chart.description %></p>



<%# アイテムを重複して持たせる構造にしてしまった以上、重複を削除するしかない%>
<%# distinctメソッドで重複を削除したテーブルを作ってeach文を回せばOK。evaluation.nameは互いに独立しているから無理か。%>
<%# 観点からユニークな要素を抜きだして、要素名でfind_byして並べる%>
<%# アイテムからユニークな要素を抜き出して、要素名でfind_byして並べる%>

<% tmp_name = [] %>
<% tmp_viewpoint = [] %>

<% @chart.evaluations.each do |evaluation| %>
    <%# もしtmp_nameに evaluation.items.first.name が含まれていなければ保存%>
    <% if !tmp_name.include?(evaluation.items.first.name) then%>
        <% tmp_name.push(evaluation.items.first.name) %>
    <%# 含まれて入ればスキップ%>
    <% end %>
    <%# もしtmp_nameに evaluation.viewpoints.first.name が含まれていなければ保存%>
    <% if !tmp_viewpoint.include?(evaluation.viewpoints.first.name) then%>
        <% tmp_viewpoint.push(evaluation.viewpoints.first.name) %>
    <%# 含まれて入ればスキップ%>
    <% end %>

<% end %>
ユニークなアイテム<%= tmp_name %>
<br>
ユニークな観点<%= tmp_viewpoint %>




<table class="table">
<thead>
  <tr>
    <th>観点</th>
    <th><%= tmp_name[0]%></th>
    <th><%= tmp_name[1]%></th>
    <th><%= tmp_name[2]%></th>
  </tr>
</thead>
<tbody>
<tr>
  <td><%= tmp_viewpoint[0]%></td>
  <td>0</td>
  <td>1</td>
  <td>2</td>
</tr>
<tr>
  <td><%= tmp_viewpoint[1]%></td>
  <td>3</td>
  <td>4</td>
  <td>5</td>
</tr>
<tr>
  <td><%= tmp_viewpoint[2]%></td>
  <td>6</td>
  <td>7</td>
  <td>8</td>
</tr>

<tbody>
</table>

<%# 配列の非空判定 %>
<% if !@chart.evaluations.empty? %>
    <ul>
    <% #カウンタ %>
    <% i = 0 %>
    <% @chart.evaluations.each do |evaluation| %>
        <% #binding.pry%>
        <li>評値値<%= i %>: <%= evaluation.score %></li> 
        <li>コメント<%= i %>: <%= evaluation.comment %></li> 
        <% #evaluation1つにつき、itemとviewpointは1つしか紐づいていないのでfirstでも正しい挙動をする %>
        <% if !evaluation.items.empty? && !evaluation.viewpoints.empty?%>
            <li>アイテム<%= i %>: <%= evaluation.items.first.name %></li> 
            <li>観点<%= i %>: <%= evaluation.viewpoints.first.name %></li> 
        <% end %>
        <% i += 1 %>
    <% end %>
    </ul>
<% else %>
    <p>評価項目がありません</p>
<% end %>

<%== pagy_bootstrap_nav(@pagy) %>

<%= link_to '一覧に戻る', charts_path %>
<%= link_to 'このメッセージを編集する', edit_chart_path(@chart) %>
<%= link_to 'このメッセージを削除する', @charts, method: :delete, data: { confirm: '本当に削除してよろしいですか？' } %>
